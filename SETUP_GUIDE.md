# CityPulse Montréal 2035 - Complete Setup Guide

## Quick Start (Simulated Data)

The system works immediately with simulated data. To test it:

### Backend:

```bash
cd backend
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt

# Run ETL pipeline
python etl/build_grid.py
python etl/compute_features.py
python etl/compute_interventions.py

# Start API
python app.py
```

### Frontend:

```bash
cd frontend
npm install
npm run dev
```

Visit: http://localhost:3000

---

## Using Real Data (Recommended for Hackathon Demo)

### Step 1: Download Datasets

Create the data folder and download files:

```bash
mkdir -p data/raw
```

Visit each dataset page and download to `data/raw/`:

#### Required Downloads:

1. **Air Quality** → `data/raw/air_quality.csv`

   - https://donnees.montreal.ca/dataset/rsqa-polluants-gazeux
   - Click on CSV resource → Download

2. **Heat Islands** → `data/raw/heat_islands.geojson`

   - https://donnees.montreal.ca/dataset/ilots-de-chaleur
   - Download GeoJSON or Shapefile

3. **Noise** → `data/raw/noise.csv`

   - https://donnees.montreal.ca/dataset/mesures-niveaux-acoustiques
   - Download CSV

4. **Traffic Segments** → `data/raw/traffic_segments.geojson`

   - https://donnees.montreal.ca/dataset/segments-routiers-de-collecte-des-temps-de-parcours
   - Download geometry file

5. **Travel Times** → `data/raw/travel_times.csv`

   - https://donnees.montreal.ca/dataset/temps-de-parcours-sur-des-segments-routiers-historique
   - Download CSV

6. **Trees** → `data/raw/trees.csv`

   - https://donnees.montreal.ca/dataset/arbres
   - Download CSV

7. **Planting Sites** → `data/raw/planting_sites.csv`

   - https://donnees.montreal.ca/dataset/emplacements-arbres
   - Download CSV

8. **Canopy** → `data/raw/canopy.geojson`

   - https://donnees.montreal.ca/dataset/canopee
   - Download GeoJSON

9. **Vulnerability** → `data/raw/vulnerability.zip`
   - https://donnees.montreal.ca/dataset/vulnerabilite-changements-climatiques
   - Download ZIP, then unzip to `data/raw/vulnerability/`

### Step 2: Configure API Keys (Optional)

For AI features, create `backend/.env`:

```bash
cp backend/.env.example backend/.env
# Edit .env and add:
```

```env
GROQ_API_KEY=your_groq_api_key_here
GOOGLE_GEMINI_API_KEY=your_gemini_api_key_here
OPENWEATHER_API_KEY=your_openweather_key_here  # Optional
```

Get API keys:

- **Groq**: https://console.groq.com/
- **Gemini**: https://ai.google.dev/
- **OpenWeather**: https://openweathermap.org/api

### Step 3: Run ETL with Real Data

```bash
cd backend
source venv/bin/activate

# The ETL will automatically detect and use real data
python etl/build_grid.py
python etl/compute_features.py
python etl/compute_interventions.py
```

You'll see output like:

```
=== Data Availability Check ===
Air Quality        : ✓ FOUND
Heat Islands       : ✓ FOUND
Trees              : ✓ FOUND
...
```

### Step 4: Start the System

**Terminal 1 - Backend:**

```bash
cd backend
source venv/bin/activate
python app.py
```

**Terminal 2 - Frontend:**

```bash
cd frontend
npm run dev
```

Visit: http://localhost:3000

---

## Features

### Interactive Map

- **CSI Grid**: Color-coded stress levels across Montréal
- **Hotspots**: Highlights cells with CSI > 70
- **Trees & Planting Sites**: Visualize green infrastructure

### Scenario Planning (Left Panel)

- Adjust car dependence (-100% to 0%)
- Increase transit investment (0% to +100%)
- Increase tree planting (0% to +100%)
- Generate AI-powered 2035 narrative

### Cell Details (Right Panel)

- Click any cell to see:
  - CSI breakdown by component
  - Vulnerability factor
  - AI-generated analysis
  - Recommended interventions

---

## Troubleshooting

### Backend won't start

```bash
# Make sure you're in venv
source backend/venv/bin/activate

# Check Python version (need 3.9+)
python --version

# Reinstall dependencies
pip install --upgrade -r backend/requirements.txt
```

### Frontend won't start

```bash
# Delete node_modules and reinstall
cd frontend
rm -rf node_modules package-lock.json
npm install
```

### CORS errors

Make sure backend is running on port 5000 and frontend on port 3000.

### Map not loading

Check browser console for errors. Make sure deck.gl and maplibre are properly installed:

```bash
cd frontend
npm install maplibre-gl react-map-gl deck.gl @deck.gl/react @deck.gl/layers
```

### Data not found

The system will work with simulated data if real files are missing. Check:

```bash
ls data/raw/
```

---

## File Structure

```
hackathon-project/
├── data/
│   ├── raw/              # Place downloaded datasets here
│   └── processed/        # Generated by ETL
├── backend/
│   ├── api/              # Flask API routes
│   ├── etl/              # Data processing scripts
│   ├── app.py            # API entry point
│   ├── ai_services.py    # Groq/Gemini integration
│   └── scenario_engine.py # 2035 scenario logic
├── frontend/
│   ├── app/              # Next.js pages
│   ├── components/       # React components
│   └── lib/              # API client & utilities
├── PRD.md                # Product requirements
└── README.md             # Project overview
```

---

## Demo Tips

1. **Start with current scenario** (all sliders at 0)
2. **Click high-stress cells** (red/orange) to show AI analysis
3. **Adjust 2035 sliders** and click "Generate Scenario Story"
4. **Toggle layers** to show trees, planting sites, hotspots
5. **Show real-time data** loading if you have real datasets

---

## Next Steps for Production

- Replace simulated data processing with real data pipelines
- Add authentication and user management
- Integrate real-time STM GTFS data
- Add temporal analysis (historical trends)
- Export reports and intervention plans
- Mobile-responsive design improvements

---

**Questions?** Check PRD.md for detailed specifications and data sources.
